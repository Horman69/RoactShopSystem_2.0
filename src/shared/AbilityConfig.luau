--!strict
-- src/shared/AbilityConfig.luau
-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Types = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("Types"))

type Ability = Types.Ability
type AbilityList = Types.AbilityList

-- ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ü–û–°–û–ë–ù–û–°–¢–ï–ô =====

local ABILITY_CONFIG: AbilityList = {
	-- ‚ö° –°–ü–û–°–û–ë–ù–û–°–¢–¨ –£–°–ö–û–†–ï–ù–ò–Ø
	{
		id = "speed_boost",
		name = "‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ",
		description = "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –±–µ–≥–∞ –¥–æ 32 –Ω–∞ 15 —Å–µ–∫—É–Ω–¥",
		category = "Movement",
		baseDuration = 15, -- —Å–µ–∫—É–Ω–¥
		cooldown = 15, -- —Å–µ–∫—É–Ω–¥ (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ UX)
		price = 50, -- –º–æ–Ω–µ—Ç
		effects = {
			{
				type = "Set",
				value = 32, -- —Å–∫–æ—Ä–æ—Å—Ç—å
				target = "WalkSpeed"
			}
		},
		icon = "‚ö°",
		isStackable = false,
		-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
		hotkey = "Q", -- –≥–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞
		visualEffect = "speed_trail", -- –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
	},
	
	-- üõ°Ô∏è –°–ü–û–°–û–ë–ù–û–°–¢–¨ –©–ò–¢–ê
	{
		id = "shield_aura",
		name = "üõ°Ô∏è –©–∏—Ç",
		description = "–°–æ–∑–¥–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—É—é –∞—É—Ä—É –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞ –Ω–∞ 15 —Å–µ–∫—É–Ω–¥", 
		category = "Shield",
		baseDuration = 15,
		cooldown = 15, -- —Å–µ–∫—É–Ω–¥ (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ UX)
		price = 75,
		effects = {
			{
				type = "Add",
				value = 50, -- +50 –∫ –∑–∞—â–∏—Ç–µ
				target = "Shield"
			}
		},
		icon = "üõ°Ô∏è",
		isStackable = true, -- –º–æ–∂–Ω–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —â–∏—Ç–æ–≤
		-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
		hotkey = "E",
		visualEffect = "shield_glow",
		shieldColor = Color3.fromRGB(0, 170, 255), -- —Ü–≤–µ—Ç —â–∏—Ç–∞
		shieldTransparency = 0.7,
	},
	
	-- üöÄ –°–ü–û–°–û–ë–ù–û–°–¢–¨ –ü–†–´–ñ–ö–ê
	{
		id = "jump_boost",
		name = "üöÄ –°—É–ø–µ—Ä –ø—Ä—ã–∂–æ–∫",
		description = "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ—Ç—É –ø—Ä—ã–∂–∫–∞ –≤ 1.5 —Ä–∞–∑–∞ –Ω–∞ 15 —Å–µ–∫—É–Ω–¥",
		category = "Movement", 
		baseDuration = 15,
		cooldown = 15, -- —Å–µ–∫—É–Ω–¥ (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ UX)
		price = 40,
		effects = {
			{
				type = "Multiply",
				value = 1.5, -- x1.5 –∫ –ø—Ä—ã–∂–∫—É
				target = "JumpHeight"
			}
		},
		icon = "üöÄ",
		isStackable = false,
		-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
		hotkey = "R",
		visualEffect = "jump_particles",
	},
}

-- ===== –ù–ê–°–¢–†–û–ô–ö–ò –ö–ê–¢–ï–ì–û–†–ò–ô =====

local CATEGORY_CONFIG = {
	Movement = {
		color = Color3.fromRGB(52, 199, 89), -- –∑–µ–ª–µ–Ω—ã–π
		icon = "üèÉ",
		description = "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è",
	},
	Shield = {
		color = Color3.fromRGB(0, 122, 255), -- —Å–∏–Ω–∏–π
		icon = "üõ°Ô∏è",
		description = "–ó–∞—â–∏—Ç–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
	},
	Combat = {
		color = Color3.fromRGB(255, 59, 48), -- –∫—Ä–∞—Å–Ω—ã–π
		icon = "‚öîÔ∏è",
		description = "–ë–æ–µ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
	},
	Utility = {
		color = Color3.fromRGB(88, 86, 214), -- —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
		icon = "üîß",
		description = "–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
	},
}

-- ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò =====

local GLOBAL_SETTINGS = {
	-- –ë–∞–ª–∞–Ω—Å
	DEFAULT_COOLDOWN = 15, -- –±–∞–∑–æ–≤—ã–π –∫—É–ª–¥–∞—É–Ω (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ UX)
	DEFAULT_DURATION = 15, -- –±–∞–∑–æ–≤–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
	PREMIUM_MULTIPLIER = 1.5, -- –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –ø—Ä–µ–º–∏—É–º –∏–≥—Ä–æ–∫–æ–≤
	
	-- –õ–∏–º–∏—Ç—ã
	MAX_ACTIVE_ABILITIES = 3, -- –º–∞–∫—Å–∏–º—É–º –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
	MAX_STACK_COUNT = 5, -- –º–∞–∫—Å–∏–º—É–º —Å—Ç–∞–∫–æ–≤ –¥–ª—è stackable —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
	
	-- UI
	ABILITY_BUTTON_SIZE = 64,
	ABILITY_BUTTON_SPACING = 8,
	HOTKEY_DISPLAY = true, -- –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
	
	-- –ó–≤—É–∫–∏
	-- –≠—Ñ—Ñ–µ–∫—Ç—ã
	ENABLE_VISUAL_EFFECTS = true,
	PARTICLE_QUALITY = "Medium", -- Low, Medium, High
}

-- ===== –§–£–ù–ö–¶–ò–ò –î–û–°–¢–£–ü–ê =====

local AbilityConfig = {}

-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
function AbilityConfig.getAllAbilities(): AbilityList
	return ABILITY_CONFIG
end

-- –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞)
function AbilityConfig.getBasicAbilities(): AbilityList
	-- –ë–∞–∑–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ - —ç—Ç–æ –≤—Å–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–∑ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
	-- –û—Å–æ–±—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ SpecialAbilityConfig
	return ABILITY_CONFIG
end

-- –ü–æ–ª—É—á–∏—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ ID
function AbilityConfig.getAbilityById(abilityId: string): Ability?
	for _, ability in ipairs(ABILITY_CONFIG) do
		if ability.id == abilityId then
			return ability
		end
	end
	return nil
end

-- –ü–æ–ª—É—á–∏—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function AbilityConfig.getAbilitiesByCategory(category: string): AbilityList
	local result: AbilityList = {}
	for _, ability in ipairs(ABILITY_CONFIG) do
		if ability.category == category then
			table.insert(result, ability)
		end
	end
	return result
end

-- –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function AbilityConfig.getCategoryConfig(category: string)
	return CATEGORY_CONFIG[category] or {
		color = Color3.fromRGB(128, 128, 128),
		icon = "‚ùì",
		description = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è",
	}
end

-- –ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
function AbilityConfig.getGlobalSettings()
	return GLOBAL_SETTINGS
end

-- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
function AbilityConfig.validateAbility(ability: Ability): boolean
	-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
	if not ability.id or not ability.name or not ability.description then
		warn("AbilityConfig: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏", ability.id or "unknown")
		return false
	end
	
	-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π
	if ability.baseDuration < 0 or ability.cooldown < 0 or ability.price < 0 then
		warn("AbilityConfig: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏", ability.id)
		return false
	end
	
	-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
	if not ability.effects or #ability.effects == 0 then
		warn("AbilityConfig: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã —É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏", ability.id)
		return false
	end
	
	-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
	for _, effect in ipairs(ability.effects) do
		if not effect.type or not effect.target or effect.value == nil then
			warn("AbilityConfig: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏", ability.id)
			return false
		end
	end
	
	return true
end

-- –í–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Å–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
for _, ability in ipairs(ABILITY_CONFIG) do
	if not AbilityConfig.validateAbility(ability) then
		error("AbilityConfig: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: " .. tostring(ability.id))
	end
end

print("‚úÖ AbilityConfig: –ó–∞–≥—Ä—É–∂–µ–Ω–æ", #ABILITY_CONFIG, "—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –≤", table.getn(CATEGORY_CONFIG), "–∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö")

return AbilityConfig
