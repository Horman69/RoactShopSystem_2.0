--!strict
-- src/client/MainLauncher.client.luau
-- –ì–ª–∞–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–∞
local player = Players.LocalPlayer
repeat wait() until player.Character

-- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
wait(0.1)

print("üöÄ MainLauncher: –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...")

-- –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ UI
local function cleanupOldUI()
	local playerGui = player:WaitForChild("PlayerGui")
	local oldUIs = {"MainApp", "TestScreenGui", "ShopApp", "AbilityUI", "MainInterfaceUI"}
	for _, uiName in ipairs(oldUIs) do
		local oldUI = playerGui:FindFirstChild(uiName)
		if oldUI then
			oldUI:Destroy()
		end
	end
end

cleanupOldUI()

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
local ModuleLoader = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("ModuleLoader"))
local Roact = ModuleLoader.require("Packages/roact")

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
local AppController = ModuleLoader.require("App/AppController")

-- –ú–æ–Ω—Ç–∏—Ä—É–µ–º AppController - –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
print("üì± MainLauncher: –ú–æ–Ω—Ç–∏—Ä—É–µ–º AppController...")
local appElement = Roact.createElement(AppController)
local appHandle = Roact.mount(appElement, player:WaitForChild("PlayerGui"), "MainApp")

print("‚úÖ MainLauncher: –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∂–µ–Ω!")

-- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
local ModuleLoader = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("ModuleLoader"))
local Roact = ModuleLoader.require("Packages/roact")

-- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
local AbilityPanel = ModuleLoader.require("App/AbilityPanel")

-- 1. –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞–Ω–µ–ª—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
local abilityElement = Roact.createElement(AbilityPanel)
local abilityHandle = Roact.mount(abilityElement, player:WaitForChild("PlayerGui"), "AbilityUI")

-- 2. –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –º–∞–≥–∞–∑–∏–Ω–∞

local AppController = ModuleLoader.require("App/AppController")
local shopHandle = nil
local isShopOpen = false
local mainHandle = nil

-- Forward declaration
local createMainUI

-- –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
local function toggleShop()
	print("üõí –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:", isShopOpen)
	
	if isShopOpen then
		-- –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
		print("üõí –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω...")
		if shopHandle then
			Roact.unmount(shopHandle)
			shopHandle = nil
			print("üõí –ú–∞–≥–∞–∑–∏–Ω —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω")
		end
		isShopOpen = false
	else
		-- –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
		print("üõí –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω...")
		local element = Roact.createElement(AppController)
		shopHandle = Roact.mount(element, player:WaitForChild("PlayerGui"), "ShopApp")
		isShopOpen = true
		print("üõí –ú–∞–≥–∞–∑–∏–Ω —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω")
	end
	
	-- –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–∞–≤–Ω—ã–π UI —Å –Ω–æ–≤—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏
	print("üõí –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –º–∞–≥–∞–∑–∏–Ω–∞...")
	if mainHandle then
		Roact.unmount(mainHandle)
	end
	local mainElement = createMainUI()
	mainHandle = Roact.mount(mainElement, player:WaitForChild("PlayerGui"), "MainInterfaceUI")
	
	print("üõí –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞:", isShopOpen)
end

-- –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π UI
function createMainUI()
	return Roact.createElement("ScreenGui", {
		Name = "MainUI",
		ResetOnSpawn = false,
	}, {
		-- –ö–Ω–æ–ø–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ (–ø—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞, –±–ª–∏–∂–µ –∫ —Ü–µ–Ω—Ç—Ä—É)
		ShopButton = Roact.createElement("TextButton", {
			BackgroundColor3 = isShopOpen and Color3.fromRGB(231, 76, 60) or Color3.fromRGB(255, 149, 0), -- –ö—Ä–∞—Å–Ω—ã–π –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç, –æ—Ä–∞–Ω–∂–µ–≤—ã–π –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç
			BorderSizePixel = 0,
			Size = UDim2.new(0, 120, 0, 50),
			Position = UDim2.new(1, -140, 0.5, -25), -- –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞, —Ü–µ–Ω—Ç—Ä –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
			Text = isShopOpen and "‚ùå –ó–ê–ö–†–´–¢–¨" or "üõí –ú–ê–ì–ê–ó–ò–ù",
			TextColor3 = Color3.fromRGB(255, 255, 255),
			TextScaled = true,
			Font = Enum.Font.GothamBold,
			[Roact.Event.Activated] = toggleShop,
		}, {
			-- –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ
			Corner = Roact.createElement("UICorner", {
				CornerRadius = UDim.new(0, 12),
			}),
			
			-- –¢–µ–Ω—å
			Shadow = Roact.createElement("Frame", {
				BackgroundColor3 = Color3.fromRGB(0, 0, 0),
				BackgroundTransparency = 0.7,
				BorderSizePixel = 0,
				Size = UDim2.new(1, 4, 1, 4),
				Position = UDim2.new(0, -2, 0, 3),
				ZIndex = -1,
			}, {
				Corner = Roact.createElement("UICorner", {
					CornerRadius = UDim.new(0, 12),
				}),
			}),
			
			-- –†–∞–º–∫–∞
			Stroke = Roact.createElement("UIStroke", {
				Color = isShopOpen and Color3.fromRGB(192, 57, 43) or Color3.fromRGB(200, 120, 0),
				Thickness = 2,
				Transparency = 0.3,
			}),
		}),
	})
end

-- –ú–æ–Ω—Ç–∏—Ä—É–µ–º –≥–ª–∞–≤–Ω—ã–π UI
local mainElement = createMainUI()
mainHandle = Roact.mount(mainElement, player:WaitForChild("PlayerGui"), "MainInterfaceUI")

-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ
