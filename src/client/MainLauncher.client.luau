--!strict
-- src/client/MainLauncher.client.luau
-- –ì–ª–∞–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - –∑–∞–≥—Ä—É–∂–∞–µ—Ç AppController

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–∞
local player = Players.LocalPlayer
repeat
	wait()
until player.Character

print("üöÄ MainLauncher: –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...")

-- –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ UI
local function cleanupOldUI()
	local playerGui = player:WaitForChild("PlayerGui")
	local oldUIs = { "MainApp", "TestScreenGui", "ShopApp", "AbilityUI", "MainInterfaceUI" }
	for _, uiName in ipairs(oldUIs) do
		local oldUI = playerGui:FindFirstChild(uiName)
		if oldUI then
			oldUI:Destroy()
			print("üßπ –û—á–∏—â–µ–Ω —Å—Ç–∞—Ä—ã–π UI:", uiName)
		end
	end
end

cleanupOldUI()

-- –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
wait(0.5)

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
print("üì¶ MainLauncher: –ó–∞–≥—Ä—É–∂–∞–µ–º ModuleLoader...")
local ModuleLoader = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("ModuleLoader"))

print("üì¶ MainLauncher: –ó–∞–≥—Ä—É–∂–∞–µ–º Roact...")
local Roact = ModuleLoader.require("Packages/roact")

print("üì¶ MainLauncher: –ó–∞–≥—Ä—É–∂–∞–µ–º AppController...")
local AppController = ModuleLoader.require("App/AppController")

print("üîß MainLauncher: AppController –∑–∞–≥—Ä—É–∂–µ–Ω, —Ç–∏–ø:", type(AppController))

-- –ú–æ–Ω—Ç–∏—Ä—É–µ–º AppController - –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–º–∞–≥–∞–∑–∏–Ω + —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
print("üì± MainLauncher: –ú–æ–Ω—Ç–∏—Ä—É–µ–º AppController...")

local success, result = pcall(function()
	local appElement = Roact.createElement(AppController)
	print("üéØ MainLauncher: –≠–ª–µ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:", appElement)
	local appHandle = Roact.mount(appElement, player:WaitForChild("PlayerGui"), "MainApp")
	print("üéØ MainLauncher: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:", appHandle)
	return appHandle
end)

if success then
	print("‚úÖ MainLauncher: –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!")
else
	print("‚ùå MainLauncher: –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:", result)
end
print("üìã MainLauncher: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–∑–¥–∞–ª–æ—Å—å...")

wait(1)
local playerGui = player:WaitForChild("PlayerGui")
local mainApp = playerGui:FindFirstChild("MainApp")
if mainApp then
	print("‚úÖ MainApp —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!")
	print("üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:", #mainApp:GetChildren())
else
	print("‚ùå MainApp –ù–ï —Å–æ–∑–¥–∞–Ω!")
end
