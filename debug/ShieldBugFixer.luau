--!strict
-- debug/ShieldBugFixer.luau
-- –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ —Å –∞—É—Ä–æ–æ–π —â–∏—Ç–∞

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local ShieldBugFixer = {}

function ShieldBugFixer.testShieldActivation()
    local player = Players.LocalPlayer
    if not player then 
        warn("‚ùå ShieldBugFixer: –ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    end
    
    print("üß™ === –¢–ï–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ò –©–ò–¢–ê ===")
    print("üìÖ –í—Ä–µ–º—è:", os.date("%H:%M:%S"))
    
    -- –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å AbilityService
    local success, AbilityService = pcall(function()
        local ModuleLoader = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("ModuleLoader"))
        return ModuleLoader.require("services/AbilityService").new()
    end)
    
    if not success then
        warn("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ AbilityService:", AbilityService)
        return
    end
    
    print("‚úÖ AbilityService –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ")
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —â–∏—Ç–∞
    local hasShield = AbilityService:isAbilityOwned(player, "shield_aura")
    print("üõ°Ô∏è –í–ª–∞–¥–µ–Ω–∏–µ —â–∏—Ç–æ–º:", hasShield and "‚úÖ –ï—Å—Ç—å" or "‚ùå –ù–µ—Ç")
    
    -- –ï—Å–ª–∏ –Ω–µ—Ç —â–∏—Ç–∞, –≤—ã–¥–∞–µ–º –µ–≥–æ
    if not hasShield then
        print("üîß –í—ã–¥–∞–µ–º —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —â–∏—Ç–∞...")
        AbilityService:grantAbility(player, "shield_aura")
        hasShield = AbilityService:isAbilityOwned(player, "shield_aura")
        print("üõ°Ô∏è –ü–æ—Å–ª–µ –≤—ã–¥–∞—á–∏:", hasShield and "‚úÖ –ï—Å—Ç—å" or "‚ùå –í—Å–µ –µ—â–µ –Ω–µ—Ç")
    end
    
    if not hasShield then
        warn("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —â–∏—Ç–∞")
        return
    end
    
    -- –ü—ã—Ç–∞–µ–º—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —â–∏—Ç
    print("üöÄ –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —â–∏—Ç–∞...")
    
    local result = AbilityService:activateAbility(player, "shield_aura")
    
    if result.success then
        print("‚úÖ –£–°–ü–ï–•: –©–∏—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!")
        print("üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:", result.message)
        print("üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∞—É—Ä—ã –≤–æ–∫—Ä—É–≥ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞")
        
        -- –ú–æ–Ω–∏—Ç–æ—Ä–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —â–∏—Ç–∞
        spawn(function()
            for i = 1, 10 do
                wait(1)
                local isOnCooldown = AbilityService:isAbilityOnCooldown(player, "shield_aura")
                local timeLeft = AbilityService:getCooldownTimeLeft(player, "shield_aura")
                
                print(string.format("‚è±Ô∏è T+%d —Å–µ–∫: –ö—É–ª–¥–∞—É–Ω=%s, –û—Å—Ç–∞–ª–æ—Å—å=%.1f", 
                    i, 
                    isOnCooldown and "üîí" or "‚úÖ", 
                    timeLeft
                ))
                
                if not isOnCooldown then
                    print("üéâ –©–∏—Ç —Å–Ω–æ–≤–∞ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!")
                    break
                end
            end
        end)
        
    else
        print("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —â–∏—Ç")
        print("üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:", result.message)
        
        local isOnCooldown = AbilityService:isAbilityOnCooldown(player, "shield_aura")
        if isOnCooldown then
            local timeLeft = AbilityService:getCooldownTimeLeft(player, "shield_aura")
            print("üîí –©–∏—Ç –Ω–∞ –∫—É–ª–¥–∞—É–Ω–µ, –æ—Å—Ç–∞–ª–æ—Å—å:", timeLeft, "—Å–µ–∫")
        end
    end
end

function ShieldBugFixer.testAbilityConfig()
    print("üîß === –¢–ï–°–¢ –ó–ê–ì–†–£–ó–ö–ò AbilityConfig ===")
    
    local success, AbilityConfig = pcall(function()
        local ModuleLoader = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("ModuleLoader"))
        return ModuleLoader.require("shared/AbilityConfig")
    end)
    
    if not success then
        warn("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ AbilityConfig:", AbilityConfig)
        return
    end
    
    print("‚úÖ AbilityConfig –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ")
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥—ã
    local allAbilities = AbilityConfig.getAllAbilities()
    print("üìä –í—Å–µ–≥–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π:", #allAbilities)
    
    -- –ò—â–µ–º —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —â–∏—Ç–∞
    local shieldAbility = AbilityConfig.getAbilityById("shield_aura")
    if shieldAbility then
        print("üõ°Ô∏è –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —â–∏—Ç–∞ –Ω–∞–π–¥–µ–Ω–∞:")
        print("  ‚Ä¢ –ò–º—è:", shieldAbility.name)
        print("  ‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:", shieldAbility.baseDuration, "—Å–µ–∫")
        print("  ‚Ä¢ –ö—É–ª–¥–∞—É–Ω:", shieldAbility.cooldown, "—Å–µ–∫")
        print("  ‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç—ã:", #shieldAbility.effects)
    else
        warn("‚ùå –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —â–∏—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!")
    end
end

function ShieldBugFixer.testPlayerStatsService()
    print("üîß === –¢–ï–°–¢ PlayerStatsService ===")
    
    local success, PlayerStatsService = pcall(function()
        local ModuleLoader = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("ModuleLoader"))
        return ModuleLoader.require("services/PlayerStatsService").new()
    end)
    
    if not success then
        warn("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ PlayerStatsService:", PlayerStatsService)
        return
    end
    
    print("‚úÖ PlayerStatsService –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ")
    print("üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ ShieldAuraService")
end

function ShieldBugFixer.fullTest()
    print("üß™ === –ü–û–õ–ù–´–ô –¢–ï–°–¢ –°–ò–°–¢–ï–ú–´ –©–ò–¢–ê ===")
    print("üìÖ –ù–∞—á–∞–ª–æ:", os.date("%H:%M:%S"))
    
    ShieldBugFixer.testAbilityConfig()
    wait(1)
    
    ShieldBugFixer.testPlayerStatsService()
    wait(1)
    
    ShieldBugFixer.testShieldActivation()
    
    print("üèÅ === –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù ===")
end

return ShieldBugFixer
