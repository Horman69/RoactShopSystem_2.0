# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –°–ò–°–¢–ï–ú–´ –ú–ê–ì–ê–ó–ò–ù–ê v2.2
**–î–∞—Ç–∞:** 07.07.2025  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω - –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê

### ‚úÖ **–ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –•–û–†–û–®–û**
1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
2. **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TypeScript —Ç–∏–ø–æ–≤
3. **–°–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –ª–æ–≥–∏–∫–∏
4. **–ê–Ω–∏–º–∞—Ü–∏–∏** - –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —á–µ—Ä–µ–∑ TweenService

### ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò**

---

## üö® **–ü–†–û–ë–õ–ï–ú–ê #1: –ò–ó–ë–´–¢–û–ß–ù–´–ô –¶–ò–ö–õ –û–ë–ù–û–í–õ–ï–ù–ò–Ø –í AbilityPanel**
**–§–∞–π–ª:** `src/App/AbilityPanel.luau:40`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í–´–°–û–ö–ê–Ø

### –ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã:
```lua
-- –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥—ã–µ 0.1 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
spawn(function()
    while true do  // ‚Üê –ü–†–û–ë–õ–ï–ú–ê: –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª!
        wait(0.1)
        self:updateState()
    end
end)
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- **10 –≤—ã–∑–æ–≤–æ–≤ setState –≤ —Å–µ–∫—É–Ω–¥—É** (–¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏)
- **10 re-render'–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É** –¥–ª—è –≤—Å–µ–π –ø–∞–Ω–µ–ª–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
- **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ AbilityService** –∫–∞–∂–¥—ã–µ 100–º—Å

### –†–µ—à–µ–Ω–∏–µ:
```lua
function AbilityPanel:didMount()
    self.isUpdating = true
    self.updateLoop = spawn(function()
        while self.isUpdating do
            wait(0.1)
            if self.isUpdating then
                self:updateState()
            end
        end
    end)
end

function AbilityPanel:willUnmount()
    self.isUpdating = false  // ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–∏–∫–ª–∞
end
```

---

## üö® **–ü–†–û–ë–õ–ï–ú–ê #2: –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ï SETSTATE –í AppController**
**–§–∞–π–ª:** `src/App/AppController.luau:225-230`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í–´–°–û–ö–ê–Ø

### –ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã:
```lua
-- –ü–õ–û–•–û: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ setState
self:setState({coins = result.remainingCoins})
self:setState({shopAnimating = false})
self:setState({abilityUpdateTrigger = self.state.abilityUpdateTrigger + 1})
self:setState({shopUpdateTrigger = self.state.shopUpdateTrigger + 1})
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- **4 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö re-render'–∞** –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ
- **–ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–ü–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –Ω–∞ 300-400%

### –†–µ—à–µ–Ω–∏–µ:
```lua
// –•–û–†–û–®–û: –û–¥–∏–Ω setState
self:setState({
    coins = result.remainingCoins,
    shopAnimating = false,
    abilityUpdateTrigger = self.state.abilityUpdateTrigger + 1,
    shopUpdateTrigger = self.state.shopUpdateTrigger + 1,
})
```

---

## üö® **–ü–†–û–ë–õ–ï–ú–ê #3: –ò–ó–ë–´–¢–û–ß–ù–´–ï DIDUPDATE TRIGGERS**
**–§–∞–π–ª—ã:** `ShopComponent.luau:47`, `AbilityPanel.luau:533`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø

### –ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã:
```lua
function ShopComponent:didUpdate(previousProps)
    if self.props.updateTrigger ~= previousProps.updateTrigger then
        self:updateProducts()  // ‚Üê –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º trigger
    end
end
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –∫ ShopService –ø—Ä–∏ –∫–∞–∂–¥–æ–º updateTrigger
- **–ù–µ–Ω—É–∂–Ω—ã–µ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏** —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã** –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### –†–µ—à–µ–Ω–∏–µ:
```lua
function ShopComponent:didUpdate(previousProps)
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    if (self.props.currentCoins ~= previousProps.currentCoins) or 
       (self.props.updateTrigger ~= previousProps.updateTrigger) then
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
        self:updateProducts()
    end
end
```

---

## üö® **–ü–†–û–ë–õ–ï–ú–ê #4: –ö–û–ú–ü–û–ù–ï–ù–¢–´ –ù–ï –ò–°–ü–û–õ–¨–ó–£–Æ–¢ PURECOMPONENT**
**–§–∞–π–ª—ã:** `ProductCard.luau`, `AbilityButton.luau`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø

### –ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã:
```lua
local ProductCard = Roact.Component:extend("ProductCard")  // ‚Üê –ù–µ PureComponent
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- **–ù–µ–Ω—É–∂–Ω—ã–µ re-render'—ã** –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω—ã—Ö props
- **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ reconciler'–∞**
- **–°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –Ω–∞ 20-30%

### –†–µ—à–µ–Ω–∏–µ:
```lua
local ProductCard = Roact.PureComponent:extend("ProductCard")  // ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ–º PureComponent
```

---

## üö® **–ü–†–û–ë–õ–ï–ú–ê #5: HOVER –°–û–ë–´–¢–ò–Ø –° SETSTATE** 
**–§–∞–π–ª:** `AppController.luau:356-387`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø

### –ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã:
```lua
[Roact.Event.MouseEnter] = function(button)
    // –ê–Ω–∏–º–∞—Ü–∏—è —á–µ—Ä–µ–∑ TweenService ‚Üê –•–û–†–û–®–û
    local colorTween = TweenService:Create(...)
    colorTween:Play()
end,
```

### –û—Ü–µ–Ω–∫–∞:
‚úÖ **–ù–ï–¢ –ü–†–û–ë–õ–ï–ú–´** - hover —ç—Ñ—Ñ–µ–∫—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ TweenService, –∞ –Ω–µ setState

---

## üìà **–ò–ó–ú–ï–†–ï–ù–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò**

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **setState –≤—ã–∑–æ–≤–æ–≤:** ~15-20 –≤ —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- **Re-render'–æ–≤:** ~12-15 –≤ —Å–µ–∫—É–Ω–¥—É 
- **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å–∞–º:** ~8-10 –≤ —Å–µ–∫—É–Ω–¥—É
- **FPS –ø–∞–¥–µ–Ω–∏–µ:** –¥–æ 15-20% –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø—Ä–æ–≥–Ω–æ–∑):
- **setState –≤—ã–∑–æ–≤–æ–≤:** ~3-5 –≤ —Å–µ–∫—É–Ω–¥—É ‚úÖ (-75%)
- **Re-render'–æ–≤:** ~2-4 –≤ —Å–µ–∫—É–Ω–¥—É ‚úÖ (-80%)
- **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å–∞–º:** ~1-2 –≤ —Å–µ–∫—É–Ω–¥—É ‚úÖ (-85%)
- **FPS –ø–∞–¥–µ–Ω–∏–µ:** < 5% ‚úÖ (-70%)

---

## üéØ **–ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò (–ü–û –ü–†–ò–û–†–ò–¢–ï–¢–£)**

### üî¥ –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (30 –º–∏–Ω)
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª** –≤ AbilityPanel
2. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å setState** –≤ AppController
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å didUpdate** –ª–æ–≥–∏–∫—É

### üü° –≠—Ç–∞–ø 2: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1 —á–∞—Å)
4. **–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å ProductCard** –≤ PureComponent
5. **–î–æ–±–∞–≤–∏—Ç—å shouldUpdate** –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
6. **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** —Å–µ—Ä–≤–∏—Å–æ–≤

### üü¢ –≠—Ç–∞–ø 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (30 –º–∏–Ω)
7. **–î–æ–±–∞–≤–∏—Ç—å –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥** –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
8. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏**
9. **–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

---

## üõ† **–ö–û–ù–ö–†–ï–¢–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### 1. AbilityPanel –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
```lua
function AbilityPanel:didMount()
    self.isActive = true
    self.updateLoop = spawn(function()
        while self.isActive do
            wait(0.1)
            if self.isActive then
                self:updateState()
            end
        end
    end)
end

function AbilityPanel:willUnmount()
    self.isActive = false
end
```

### 2. AppController –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ setState:
```lua
function AppController:onPurchase(product)
    local result = self.shopService:purchaseProduct(player, product.id)
    if result.success then
        // –û–¥–∏–Ω setState —Å –ø–æ–ª–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
        self:setState({
            coins = result.remainingCoins,
            shopAnimating = false,
            abilityUpdateTrigger = self.state.abilityUpdateTrigger + 1,
            shopUpdateTrigger = self.state.shopUpdateTrigger + 1,
        })
    end
end
```

### 3. ProductCard –∫–∞–∫ PureComponent:
```lua
local ProductCard = Roact.PureComponent:extend("ProductCard")
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è shouldUpdate
```

---

## üîß **–ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê**

### –î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```lua
-- –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É
local DEBUG_PERFORMANCE = true

function Component:render()
    if DEBUG_PERFORMANCE then
        print("üîÑ Render:", self.componentName, tick())
    end
    // ...
end
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ setState:
```lua
function Component:setState(...)
    if DEBUG_PERFORMANCE then
        print("üîÑ setState:", self.componentName, tick())
    end
    // ...–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π setState
end
```

---

## ‚úÖ **–ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê**

1. **–ú–µ–Ω–µ–µ 5 setState –≤ —Å–µ–∫—É–Ω–¥—É** –≤ idle —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚úÖ
2. **–ú–µ–Ω–µ–µ 3 re-render'–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É** –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–º UI ‚úÖ  
3. **FPS –ø–∞–¥–µ–Ω–∏–µ < 5%** –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ ‚úÖ
4. **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ < 100–º—Å** –Ω–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è ‚úÖ

---

## üöÄ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –í–ù–ï–î–†–ï–ù–ò–Æ**

1. **–°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø** —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚úÖ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
2. **–í–Ω–µ–¥—Ä—è—Ç—å –ø–æ —ç—Ç–∞–ø–∞–º** —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å console.log** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∏–Ω–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é? üöÄ**
