# üîç –ê–£–î–ò–¢ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –°–ò–°–¢–ï–ú–´ –ú–ê–ì–ê–ó–ò–ù–ê
**–î–∞—Ç–∞:** 07.07.2025  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–£–î–ò–¢–ê

### ‚úÖ **–•–û–†–û–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò** (–ù–∞–π–¥–µ–Ω–æ)
1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç UI
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ ModuleLoader** - –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ refs** - –∏–∑–±–µ–≥–∞–µ–º –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
4. **–£—Å–ª–æ–≤–Ω—ã–µ —Ä–µ–Ω–¥–µ—Ä—ã** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### ‚ùå **–ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò** (–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ)

#### üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ setState**
**–§–∞–π–ª:** `AppController.luau`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ setState –≤ –º–µ—Ç–æ–¥–∞—Ö –ø–æ–∫—É–ø–∫–∏
```lua
// –ü–õ–û–•–û: 3 setState –ø–æ–¥—Ä—è–¥
self:setState({shopAnimating = true})
// ... –∫–æ–¥ –ø–æ–∫—É–ø–∫–∏ ...
self:setState({shopAnimating = false})
self:setState({
    abilityUpdateTrigger = self.state.abilityUpdateTrigger + 1,
    shopUpdateTrigger = self.state.shopUpdateTrigger + 1,
})
```

**–†–µ—à–µ–Ω–∏–µ:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω setState
```lua
// –•–û–†–û–®–û: –û–¥–∏–Ω setState
self:setState({
    shopAnimating = false,
    abilityUpdateTrigger = self.state.abilityUpdateTrigger + 1,
    shopUpdateTrigger = self.state.shopUpdateTrigger + 1,
})
```

#### üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #2: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ didUpdate**
**–§–∞–π–ª:** `ShopComponent.luau` + `AbilityPanel.luau`
**–ü—Ä–æ–±–ª–µ–º–∞:** didUpdate —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º updateTrigger
```lua
// –ü–†–û–ë–õ–ï–ú–ê: –ö–∞–∂–¥—ã–π trigger –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É
function ShopComponent:didUpdate(previousProps)
    if self.props.updateTrigger ~= previousProps.updateTrigger then
        self:updateProducts() // ‚Üê –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê
    end
end
```

#### ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê #3: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π**
**–§–∞–π–ª:** `AbilityPanel.luau`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –≤ updateState
```lua
// –ù–ï–≠–§–§–ï–ö–¢–ò–í–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –í–°–ï —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑
local baseAbilities = {"speed_boost", "shield_aura", "jump_boost"}
for _, abilityId in ipairs(baseAbilities) do
    local isOnCooldown = self.abilityService:isAbilityUnavailableForUI(player, abilityId)
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–∂–µ –¥–ª—è –Ω–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π!
end
```

#### ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê #4: Hover —Å–æ–±—ã—Ç–∏—è –Ω–∞ –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–µ**
**–§–∞–π–ª:** `AbilityButton.luau`
**–ü—Ä–æ–±–ª–µ–º–∞:** setState –ø—Ä–∏ –∫–∞–∂–¥–æ–º hover/leave
```lua
// –ú–ù–û–ì–û –†–ï–ù–î–ï–†–û–í: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∏
[Roact.Event.MouseEnter] = function()
    self:setState({ isHovering = true }) // ‚Üê setState!
end,
[Roact.Event.MouseLeave] = function()
    self:setState({ isHovering = false }) // ‚Üê setState!
end,
```

## üéØ **–ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò**

### 1. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å setState –≤ AppController**
```lua
// –í–ú–ï–°–¢–û –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö setState
function AppController:onShopItemPurchase(product)
    // –û–¥–∏–Ω setState —Å –ø–æ–ª–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
    self:setState({
        coins = newCoins,
        shopAnimating = false,
        abilityUpdateTrigger = self.state.abilityUpdateTrigger + 1,
        shopUpdateTrigger = self.state.shopUpdateTrigger + 1,
    })
end
```

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PureComponent –¥–ª—è ProductCard**
```lua
// –ò–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–∏—Ö —Ä–µ–Ω–¥–µ—Ä–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
local ProductCard = Roact.PureComponent:extend("ProductCard")
```

### 3. **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π**
```lua
// –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
function AbilityPanel:updateStateOptimized()
    local changes = {}
    for abilityId in pairs(self.state.abilities) do
        local newCooldown = self.abilityService:getCooldownInfo(abilityId)
        if newCooldown ~= self.cachedCooldowns[abilityId] then
            changes[abilityId] = newCooldown
        end
    end
    
    if next(changes) then // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        self:setState(changes)
    end
end
```

### 4. **–£–±—Ä–∞—Ç—å hover setState (–∏–ª–∏ –¥–µ–±–∞—É–Ω—Å–∏—Ç—å)**
```lua
// –í–ê–†–ò–ê–ù–¢ 1: –£–±—Ä–∞—Ç—å setState –¥–ª—è hover
// –í–ê–†–ò–ê–ù–¢ 2: –î–µ–±–∞—É–Ω—Å–∏–Ω–≥
function AbilityButton:debouncedHover()
    if self.hoverDebounce then return end
    self.hoverDebounce = true
    
    spawn(function()
        wait(0.1) // –î–µ–±–∞—É–Ω—Å 100–º—Å
        self.hoverDebounce = false
        self:setState({ isHovering = true })
    end)
end
```

## üìà **–û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø**

### –ë–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (—Å–µ–π—á–∞—Å):
- **setState –≤—ã–∑–æ–≤–æ–≤:** ~15-20 –≤ —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- **–†–µ–Ω–¥–µ—Ä–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** ~10-12 –≤ —Å–µ–∫—É–Ω–¥—É
- **–ü—Ä–æ–≤–µ—Ä–æ–∫ AbilityService:** ~3-4 –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- **setState –≤—ã–∑–æ–≤–æ–≤:** ~3-5 –≤ —Å–µ–∫—É–Ω–¥—É ‚úÖ (-70%)
- **–†–µ–Ω–¥–µ—Ä–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** ~2-3 –≤ —Å–µ–∫—É–Ω–¥—É ‚úÖ (-75%)
- **–ü—Ä–æ–≤–µ—Ä–æ–∫ AbilityService:** ~1-2 –≤ —Å–µ–∫—É–Ω–¥—É —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö ‚úÖ (-60%)

## üöÄ **–ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò**

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (30 –º–∏–Ω)
1. ‚úÖ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å setState –≤ AppController
2. ‚úÖ –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å ProductCard –≤ PureComponent
3. ‚úÖ –£–±—Ä–∞—Ç—å hover setState –∏–∑ AbilityButton

### –≠—Ç–∞–ø 2: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1 —á–∞—Å)
4. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
5. ‚úÖ –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ updateTrigger
6. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è didUpdate –ª–æ–≥–∏–∫–∏

### –≠—Ç–∞–ø 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (15 –º–∏–Ω)
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
8. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ setState –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üí° **–í–´–í–û–î**

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ setState –∏ —Ä–µ–Ω–¥–µ—Ä—ã –∏–∑-–∑–∞ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

**–ü—Ä–æ–≥–Ω–æ–∑:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏—Ç—Å—è –Ω–∞ **60-75%**, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å UI.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô - –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –ø—Ä–∏ —á–∞—Å—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.
